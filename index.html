const axios = require('axios');

// TikTok API request options
const tiktokOptions = {
  method: 'GET',
  url: 'https://tiktok.livecounts.io/video/stats/7326276358487739681',
  headers: {
    'Accept': '*/*',
    'Accept-Language': 'en-US,en;q=0.9',
    'If-None-Match': 'W/"62-x08NcgFIf5DLoDdQvaz3cG4B2Y8"',
    'Origin': 'https://tokcounter.com',
    'Referer': 'https://tokcounter.com/',
    'Sec-Fetch-Dest': 'empty',
    'Sec-Fetch-Mode': 'cors',
    'Sec-Fetch-Site': 'cross-site',
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.0.0 Safari/537.36 OPR/105.0.0.0',
  },
};

// Your Discord Webhook URL
const discordWebhookUrl = 'https://discord.com/api/webhooks/1192150497856069784/CceF5VG4p_MVqp64sO7bDR8TB3_xUasjLk_u48lJzjhdh_MoqDFmtq5TLSisPlBq3RIU';

// Function to create a detailed embed with cool text and timestamp
function createDetailedEmbed(data) {
  const coolText = '**Cool**';
  const additionalDetails = `Here's some ${coolText} data from TikTok. More details: ${JSON.stringify(data)}`;

  return {
    embeds: [{
      title: 'Detailed TikTok Data',
      description: additionalDetails,
      color: 0x3498db, // Blue color
      timestamp: new Date(),
    }],
  };
}

// Function to fetch data from TikTok and send it to Discord
function fetchDataAndSendToDiscord() {
  axios(tiktokOptions)
    .then((response) => {
      const data = response.data;
      // Process the data as needed
      console.log('Detailed TikTok data:', data);

      // Send the data to Discord webhook with a detailed embed
      axios.post(discordWebhookUrl, createDetailedEmbed(data))
        .then(() => {
          console.log('Data sent to Discord successfully.');
        })
        .catch((error) => {
          console.error('Error sending data to Discord:', error.message);
        });
    })
    .catch((error) => {
      console.error('Error fetching data from TikTok:', error.message);
    });
}

// Set up the interval to fetch data and send to Discord every 5 seconds
const intervalId = setInterval(fetchDataAndSendToDiscord, 5000);

// Stop the interval after a specific time (e.g., 60 seconds in this example)
setTimeout(() => {
  clearInterval(intervalId);
  console.log('Interval stopped. Cool stuff!');
}, 60000000); // Stop after 60 seconds
